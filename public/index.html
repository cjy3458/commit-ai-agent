<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Commit Ai agent — AI 커밋 분석기</title>
    <meta
      name="description"
      content="AI 기반 git 커밋 문서화 및 코드 리뷰 에이전트"
    />
    <meta name="theme-color" content="#6366f1" />
    <link rel="icon" type="image/svg+xml" href="/icon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <header class="header">
      <div class="header-inner">
        <div class="logo">
          <span class="logo-icon">⚡</span>
          <span class="logo-text">Commit Ai agent</span>
          <span class="logo-badge">AI</span>
        </div>
        <nav class="header-nav">
          <button class="nav-btn active" data-tab="analyze" id="btn-analyze">
            분석하기
          </button>
          <button class="nav-btn" data-tab="reports" id="btn-reports">
            리포트
          </button>
          <button class="nav-btn" data-tab="hooks" id="btn-hooks">
            훅 관리
          </button>
        </nav>
        <div class="aria-chip" id="aria-chip">
          <span class="aria-chip-dot" id="aria-chip-dot"></span>
          <span id="aria-chip-text">Hanni · 대기 중</span>
        </div>
      </div>
    </header>

    <main class="main">
      <!-- ── Tab: Analyze ── -->
      <section class="tab-content active" id="tab-analyze">
        <!-- ── Aria Hero ── -->
        <div class="aria-hero">
          <div class="aria-robot-wrap idle" id="aria-robot-wrap">
            <svg
              class="aria-robot"
              viewBox="0 0 90 115"
              width="90"
              height="115"
              xmlns="http://www.w3.org/2000/svg"
            >
              <defs>
                <linearGradient
                  id="rg-head"
                  x1="0%"
                  y1="0%"
                  x2="100%"
                  y2="100%"
                >
                  <stop offset="0%" stop-color="#6366f1" />
                  <stop offset="100%" stop-color="#22d3ee" />
                </linearGradient>
                <linearGradient
                  id="rg-body"
                  x1="0%"
                  y1="0%"
                  x2="100%"
                  y2="100%"
                >
                  <stop offset="0%" stop-color="#4f46e5" />
                  <stop offset="100%" stop-color="#0e7490" />
                </linearGradient>
              </defs>
              <!-- Antenna -->
              <line
                x1="45"
                y1="7"
                x2="45"
                y2="20"
                stroke="#818cf8"
                stroke-width="2.5"
                stroke-linecap="round"
              />
              <circle
                class="aria-antenna-dot"
                cx="45"
                cy="5"
                r="5"
                fill="#818cf8"
              />
              <!-- Ears -->
              <rect
                x="1"
                y="34"
                width="9"
                height="18"
                rx="4.5"
                fill="#4f46e5"
              />
              <rect
                x="80"
                y="34"
                width="9"
                height="18"
                rx="4.5"
                fill="#4f46e5"
              />
              <!-- Head -->
              <rect
                x="9"
                y="18"
                width="72"
                height="62"
                rx="20"
                fill="url(#rg-head)"
              />
              <!-- Eyes white -->
              <circle cx="30" cy="48" r="13" fill="white" opacity="0.92" />
              <circle cx="60" cy="48" r="13" fill="white" opacity="0.92" />
              <!-- Pupils -->
              <circle cx="32" cy="49" r="7.5" fill="#1e1b4b" />
              <circle cx="62" cy="49" r="7.5" fill="#1e1b4b" />
              <!-- Eye shine -->
              <circle cx="35" cy="45" r="2.5" fill="white" />
              <circle cx="65" cy="45" r="2.5" fill="white" />
              <!-- Smile -->
              <path
                d="M 32 63 Q 45 73 58 63"
                stroke="white"
                stroke-width="2.8"
                fill="none"
                stroke-linecap="round"
              />
              <!-- Body -->
              <rect
                x="20"
                y="84"
                width="50"
                height="28"
                rx="12"
                fill="url(#rg-body)"
              />
              <!-- Body buttons -->
              <circle cx="34" cy="98" r="5" fill="rgba(255,255,255,0.35)" />
              <circle cx="45" cy="98" r="5" fill="rgba(255,255,255,0.35)" />
              <circle cx="56" cy="98" r="5" fill="rgba(255,255,255,0.35)" />
            </svg>
          </div>
          <div class="aria-bubble-wrap">
            <div class="aria-bubble">
              <span class="aria-bubble-text" id="aria-bubble-text"
                >어떤 프로젝트의 커밋을 분석해드릴까요?</span
              >
              <span
                class="aria-typing-dots"
                id="aria-typing-dots"
                style="display: none"
              >
                <span></span><span></span><span></span>
              </span>
            </div>
            <div class="aria-name-badge">Hanni</div>
          </div>
        </div>

        <!-- API Key Warning -->
        <div class="alert alert-warn" id="api-key-warn" style="display: none">
          ⚠️ <strong>.env</strong> 파일에 <code>GEMINI_API_KEY</code>가 설정되지
          않았습니다. <code>c:\dev\commit-analyzer\.env</code> 파일을 생성하고
          키를 입력해 주세요.
        </div>

        <!-- Project Selector Card -->
        <div class="card selector-card">
          <div class="card-header">
            <h2 class="card-title">🗂 프로젝트 선택</h2>
            <button class="refresh-btn" id="refresh-projects" title="새로고침">
              ↻
            </button>
          </div>
          <!-- Mode Toggle -->
          <div class="mode-toggle">
            <button class="mode-btn active" id="mode-commit" data-mode="commit">
              📦 최근 커밋 분석
            </button>
            <button class="mode-btn" id="mode-status" data-mode="status">
              🔍 현재 변경사항 분석
            </button>
          </div>
          <div class="project-grid" id="project-grid">
            <div class="skeleton-grid">
              <div class="skeleton"></div>
              <div class="skeleton"></div>
              <div class="skeleton"></div>
            </div>
          </div>
          <div class="card-footer">
            <span class="selected-hint" id="selected-hint"
              >프로젝트를 선택해 주세요</span
            >
            <button class="btn-primary" id="analyze-btn" disabled>
              <span class="btn-icon">🤖</span>
              <span id="analyze-btn-text">Hanni에게 분석 요청</span>
            </button>
          </div>
        </div>

        <!-- Working Status Card (hidden until project selected in status mode) -->
        <div class="card commit-card" id="status-card" style="display: none">
          <h2 class="card-title">🔧 현재 변경사항 (미커밋)</h2>
          <div class="commit-meta" id="status-meta"></div>
          <div class="diff-toggle">
            <button class="btn-ghost" id="status-diff-toggle-btn">
              diff 보기 ▾
            </button>
            <pre
              class="diff-content"
              id="status-diff-content"
              style="display: none"
            ></pre>
          </div>
        </div>

        <!-- Commit Info Card (hidden until project selected) -->
        <div class="card commit-card" id="commit-card" style="display: none">
          <h2 class="card-title">📦 최근 커밋</h2>
          <div class="commit-meta" id="commit-meta"></div>
          <div class="diff-toggle">
            <button class="btn-ghost" id="diff-toggle-btn">diff 보기 ▾</button>
            <pre
              class="diff-content"
              id="diff-content"
              style="display: none"
            ></pre>
          </div>
        </div>

        <!-- Analysis Output -->
        <div class="card result-card" id="result-card" style="display: none">
          <div class="result-header">
            <h2 class="card-title">🤖 Hanni의 분석 리포트</h2>
            <div class="result-actions">
              <button class="btn-ghost" id="copy-btn" style="display: none">
                📋 복사
              </button>
              <span class="report-saved" id="report-saved"></span>
            </div>
          </div>
          <!-- Status bar -->
          <div class="status-bar" id="status-bar">
            <span class="status-dot loading"></span>
            <span id="status-msg">분석 준비 중...</span>
          </div>
          <!-- Streaming output -->
          <div class="analysis-body" id="analysis-body"></div>
        </div>
      </section>

      <!-- ── Tab: Hooks ── -->
      <section class="tab-content" id="tab-hooks">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">🪝 Git Hook 관리</h2>
            <button class="btn-ghost" id="refresh-hooks" title="새로고침">
              ↻
            </button>
          </div>
          <p class="hook-desc">
            훅을 설치하면 <strong>커밋할 때마다 자동으로 AI 분석</strong>이
            실행되고, <strong>push 전에 secret 유출을 자동 차단</strong>합니다.
          </p>

          <div class="hook-section">
            <div class="hook-section-title">
              <span class="hook-icon">⚡</span>
              post-commit — 자동 커밋 분석
            </div>
            <p class="hook-section-desc">
              커밋 직후 Gemini AI가 백그라운드에서 분석 리포트를 자동
              생성합니다.
            </p>
          </div>

          <div class="hook-section">
            <div class="hook-section-title">
              <span class="hook-icon">⛔</span>
              pre-push — Secret 유출 탐지
            </div>
            <p class="hook-section-desc">
              push 전에 API 키, 비밀번호, private key 등의 유출을 탐지하고
              차단합니다.
            </p>
          </div>

          <div id="hook-projects-list" class="hook-projects-list">
            <p class="empty-state">불러오는 중...</p>
          </div>
        </div>

        <div class="card hook-cli-card">
          <h2 class="card-title">💻 CLI 사용법</h2>
          <div class="hook-cli-block">
            <div class="hook-cli-item">
              <code>commit-ai-agent hook install</code>
              <span>현재 디렉토리에 훅 설치</span>
            </div>

            <div class="hook-cli-item">
              <code>commit-ai-agent hook remove</code>
              <span>훅 제거</span>
            </div>
            <div class="hook-cli-item">
              <code>commit-ai-agent hook status</code>
              <span>설치 상태 확인</span>
            </div>
            <div class="hook-cli-item">
              <code>SKIP_SECRET_SCAN=1 git push</code>
              <span>Secret 스캔 일시 스킵 (오탐 시)</span>
            </div>
          </div>
        </div>
      </section>

      <!-- ── Tab: Reports ── -->
      <section class="tab-content" id="tab-reports">
        <div class="card">
          <h2 class="card-title">📁 저장된 리포트</h2>
          <div id="reports-list" class="reports-list">
            <p class="empty-state">아직 저장된 리포트가 없습니다.</p>
          </div>
        </div>
        <div class="card" id="report-viewer" style="display: none">
          <div class="result-header">
            <h2 class="card-title" id="report-viewer-title">리포트</h2>
            <button class="btn-ghost" id="close-report-btn">✕ 닫기</button>
          </div>
          <div class="analysis-body" id="report-viewer-body"></div>
        </div>
      </section>
    </main>

    <script src="/app.js"></script>
  </body>
</html>
